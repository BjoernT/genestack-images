FROM python:3.9-slim

WORKDIR /app

# Copy requirements and install dependencies
COPY scripts/openstack-exporter-app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the exporter script
COPY scripts/openstack-exporter-app/openstack_exporter.py .

# Expose port from environment variable, default to 49152
ARG EXPORTER_PORT=49152
ENV EXPORTER_PORT=${EXPORTER_PORT}
EXPOSE ${EXPORTER_PORT}

# Run the exporter, expecting config.yaml to be mounted
CMD ["python", "openstack_exporter.py"]
